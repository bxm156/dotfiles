services:
  dotfiles-test:
    platform: ${DOCKER_PLATFORM:-linux/amd64}
    build:
      context: .
      dockerfile: Dockerfile.test
      network: host
    image: dotfiles-test
    volumes:
      - ./:/home/user/.local/share/chezmoi:ro
      - ./tests:/opt/tests:ro
    entrypoint: ["/opt/tests/test-dotfiles.sh"]
    working_dir: /home/user
    stdin_open: true
    tty: true
    environment:
      - TERM=xterm-256color
      - HOME=/home/user

  dotfiles-test-github:
    platform: ${DOCKER_PLATFORM:-linux/amd64}
    build:
      context: .
      dockerfile: Dockerfile.test
      network: host
    image: dotfiles-test
    # No volumes mounted - pulls directly from GitHub
    volumes:
      - ./tests:/opt/tests:ro
    entrypoint: ["/opt/tests/test-dotfiles-github.sh"]
    working_dir: /home/user
    stdin_open: true
    tty: true
    environment:
      - TERM=xterm-256color
      - HOME=/home/user
