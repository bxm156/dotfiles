[tools]
node = "latest"
claude = "latest"
chezmoi = "latest"

[tasks.test]
description = "Test dotfiles in isolated container"
run = """
docker compose run --rm --user root dotfiles-test bash -c '
  # Setup user and install packages
  useradd -u 3000 -M -s /bin/bash user
  chown -R user:user /home/user
  apt-get update && apt-get install -y curl zsh

  # Switch to user and run chezmoi
  su - user -c "
    mkdir -p ~/.local/bin
    sh -c \\\"\\$(curl -fsLS get.chezmoi.io/lb)\\\" -- init --apply -v --source ~/.local/share/chezmoi
    echo \\\"✓ Dotfiles applied successfully\\\"

    # Test zsh starts
    zsh -c \\\"echo ✓ Zsh version: \\$ZSH_VERSION\\\"

    # Test key tools are available
    zsh -i -c \\\"
      command -v starship >/dev/null && echo ✓ Starship found || echo ✗ Starship missing
      echo ✓ Shell config loaded successfully
    \\\"
  "
'
"""

[tasks."test:interactive"]
description = "Open interactive test container"
run = "docker compose run --rm dotfiles-test"

[tasks."test:render"]
description = "Test template rendering and syntax validation"
run = ".test-data/test-render-simple.sh"